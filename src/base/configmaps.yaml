apiVersion: v1
kind: ConfigMap
metadata:
  name: techfood-api-config
  namespace: techfood
  labels:
    app.kubernetes.io/name: techfood-api
    app.kubernetes.io/component: config
    app.kubernetes.io/part-of: techfood-system
data:
  ASPNETCORE_ENVIRONMENT: "Development"
  ASPNETCORE_HTTP_PORTS: "8080"
  TechFoodStaticImagesUrl: "/static-images"
  AllowedHosts: "*"
  Jwt__Issuer: "techfood-jwts"
  Jwt__Audience: "techfood"
  Payments__MercadoPago__UserId: "2414323212"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: custom-headers
  namespace: techfood
  labels:
    app.kubernetes.io/name: custom-headers
    app.kubernetes.io/component: configmap
    app.kubernetes.io/part-of: techfood-system
data:
  Host: "$host"
  X-Real-IP: "$remote_addr"
  X-Forwarded-For: "$proxy_add_x_forwarded_for"
  X-Forwarded-Proto: "$scheme"
  X-Forwarded-Host: "$host:$server_port"
  X-Original-URI: "$request_uri"
  X-Request-ID: "$req_id"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-configuration
  namespace: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
data:
  proxy-set-headers: "techfood/custom-headers"
  use-forwarded-headers: "true"
  compute-full-forwarded-for: "true"
  use-proxy-protocol: "false"

  proxy-connect-timeout: "30"
  proxy-send-timeout: "30"
  proxy-read-timeout: "30"
  proxy-body-size: "10m"

  http-snippet: |
    map $http_x_forwarded_prefix $prefix {
        default "";
        "~^/api" "/api";
    }

  location-snippet: |
    proxy_set_header X-Forwarded-Prefix $prefix;
---
